# Honnyaku ユーザーマニュアル

Honnyakuの詳細な使い方を説明します。

## 目次

- [インストール](#インストール)
- [初回セットアップ](#初回セットアップ)
- [基本的な使い方](#基本的な使い方)
- [設定のカスタマイズ](#設定のカスタマイズ)
- [トラブルシューティング](#トラブルシューティング)
- [FAQ](#faq)

---

## インストール

### システム要件

- **オペレーティングシステム**: macOS 12.0 (Monterey) 以上
- **アーキテクチャ**: Apple Silicon (M1/M2/M3) または Intel
- **ディスク空き容量**: 最低500MB（Ollamaモデルを含む場合は2-5GB）
- **メモリ**: 最低4GB RAM（8GB以上推奨）

### インストール手順

#### 1. DMGファイルのダウンロード

[GitHub Releases](https://github.com/sk8metalme/honnyaku/releases)ページから最新版のDMGファイルをダウンロードします。

- **Apple Silicon (M1/M2/M3)**: `honnyaku_x.x.x_aarch64.dmg`
- **Intel Mac**: `honnyaku_x.x.x_x64.dmg`

#### 2. DMGファイルを開く

ダウンロードしたDMGファイルをダブルクリックしてマウントします。

#### 3. アプリをインストール

1. マウントされたDMGウィンドウで、`Honnyaku.app`を「アプリケーション」フォルダにドラッグ&ドロップ
2. インストール完了後、DMGをアンマウント（イジェクト）

#### 4. 初回起動

1. 「アプリケーション」フォルダから`Honnyaku.app`を起動
2. 「開発元を確認できないため開けません」と表示された場合：
   - **方法1**: アプリを右クリック（またはControlキー+クリック） → 「開く」を選択
   - **方法2**: システム環境設定 → プライバシーとセキュリティ → 「このまま開く」をクリック

---

## 初回セットアップ

### 1. Ollamaのインストール

Honnyakuは翻訳にOllama（ローカルLLM）を使用します。

#### Homebrewでインストール（推奨）

```bash
# Homebrewがインストールされていない場合
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Ollamaをインストール
brew install ollama

# Ollamaを起動
ollama serve
```

#### 公式サイトからインストール

1. [Ollama公式サイト](https://ollama.ai)にアクセス
2. macOS用のインストーラーをダウンロード
3. インストーラーを実行
4. Ollamaを起動

### 2. 翻訳モデルのインストール

Ollamaが起動したら、翻訳用のLLMモデルをインストールします。

#### 推奨モデル: qwen2.5:3b

```bash
ollama pull qwen2.5:3b
```

**特徴**:
- サイズ: 1.9GB
- 品質: バランスの取れた翻訳品質
- 速度: 標準的な翻訳速度
- 推奨用途: 日常的な翻訳作業

#### その他のモデル

| モデル | サイズ | 品質 | 速度 | 推奨用途 |
|--------|--------|------|------|----------|
| qwen2.5:0.5b | 395MB | 低 | 最速 | クイック翻訳、低スペックPC |
| qwen2.5:1.5b | 986MB | 中 | 高速 | 日常的な翻訳 |
| qwen2.5:3b | 1.9GB | 中-高 | 標準 | **一般用途（推奨）** |
| qwen2.5:7b | 4.7GB | 高 | 低速 | 高品質が必要な翻訳 |

#### 日本語特化モデル（上級者向け）

より高品質な日本語翻訳が必要な場合、ABEJA-Qwen2.5-7b-Japaneseモデルを使用できます。

詳細な手順は[README.md](../README.md#21-日本語特化モデルabeja-qwen25-7b-japaneseのインストール)を参照してください。

### 3. アクセシビリティ権限の許可

Honnyakuがグローバルショートカットを使用するには、macOSのアクセシビリティ権限が必要です。

#### 自動リクエスト

初回起動時、Honnyakuは自動的にアクセシビリティ権限をリクエストします：

1. 「システム環境設定を開く」ダイアログが表示される
2. 「システム環境設定を開く」をクリック
3. プライバシーとセキュリティ → アクセシビリティ
4. Honnyakuの横にチェックを入れる
5. 管理者パスワードを入力

#### 手動設定

権限が許可されていない場合、手動で設定できます：

1. システム環境設定を開く
2. プライバシーとセキュリティ → アクセシビリティ
3. 鍵アイコンをクリックして変更を許可
4. 「+」ボタンをクリック
5. 「アプリケーション」フォルダから`Honnyaku.app`を選択
6. Honnyakuの横にチェックを入れる

---

## 基本的な使い方

### ステップ1: Honnyakuを起動

「アプリケーション」フォルダから`Honnyaku.app`を起動します。

起動すると、Honnyakuのメインウィンドウが表示され、以下の情報が確認できます：

- アクセシビリティ権限のステータス（許可済み/未許可）
- 登録されたショートカットキー
- 使用中のOllamaモデル

### ステップ2: Ollamaの起動確認

Honnyakuの設定画面で「接続をテスト」ボタンをクリックし、Ollamaが正常に動作していることを確認します。

- **成功**: 「Ollamaに接続できました」と表示される
- **失敗**: 「Ollamaに接続できません」と表示される
  - ターミナルで`ollama serve`を実行してOllamaを起動

### ステップ3: テキストを翻訳

1. **翻訳したいテキストを選択**

   任意のアプリケーション（Safari、Chrome、メモ、PDFビューアーなど）で、翻訳したいテキストをマウスでドラッグして選択します。

2. **ショートカットキーを押す**

   デフォルト: `Cmd+J`

3. **翻訳結果を確認**

   - カーソル位置近くに小さなポップアップウィンドウが表示されます
   - 翻訳結果が表示されます
   - ローディング中は「翻訳中...」と表示されます

4. **翻訳結果をコピー（オプション）**

   - ポップアップ内の「コピー」ボタンをクリック
   - または、ポップアップにフォーカスがある状態で`Cmd+C`を押す
   - 翻訳結果がクリップボードにコピーされます

5. **ポップアップを閉じる**

   - `Esc`キーを押す
   - ポップアップ外の任意の場所をクリック

### 翻訳の例

#### 日本語 → 英語

**入力**: 「こんにちは、世界！」
**出力**: "Hello, world!"

#### 英語 → 日本語

**入力**: "The quick brown fox jumps over the lazy dog."
**出力**: 「素早い茶色のキツネが怠惰な犬を飛び越える。」

---

## 設定のカスタマイズ

### 設定画面を開く

1. Honnyakuのメインウィンドウで、右上の歯車アイコンをクリック
2. 設定パネルが表示されます

### ショートカットキーの変更

デフォルトのショートカットキー（`Cmd+J`）を変更できます。

1. 設定画面で「ショートカットキー」入力フィールドをクリック
2. 新しいショートカットキーを入力（例: `CommandOrControl+Shift+T`）
3. 「保存」ボタンをクリック
4. Honnyakuを再起動して変更を適用

#### ショートカットキーの形式

- **Cmd（Command）**: `CommandOrControl` または `Cmd`
- **Shift**: `Shift`
- **Option（Alt）**: `Option` または `Alt`
- **Control**: `Control` または `Ctrl`

**例**:
- `CommandOrControl+J`: Cmd+J
- `CommandOrControl+Shift+T`: Cmd+Shift+T
- `CommandOrControl+Option+J`: Cmd+Option+J

### Ollamaエンドポイントの変更

デフォルトでは`http://localhost:11434`が使用されます。リモートのOllamaサーバーを使用する場合は変更できます。

1. 設定画面で「Ollamaエンドポイント」入力フィールドに新しいURLを入力
2. 「保存」ボタンをクリック

**例**:
- `http://localhost:11434`（ローカル）
- `http://192.168.1.100:11434`（ローカルネットワーク）

### Ollamaモデルの変更

使用するLLMモデルを変更できます。

1. 事前に新しいモデルをインストール: `ollama pull <model-name>`
2. 設定画面で「Ollamaモデル」入力フィールドに新しいモデル名を入力
3. 「保存」ボタンをクリック

**例**:
- `qwen2.5:3b`（デフォルト）
- `qwen2.5:7b`（高品質）
- `abeja-qwen2.5-7b-jp`（日本語特化）

### 接続テスト

Ollama設定を変更したら、「接続をテスト」ボタンで接続を確認します。

- **成功**: 緑色のチェックマークと「接続成功」メッセージ
- **失敗**: 赤色のXマークと「接続失敗」メッセージ
  - エンドポイントが正しいか確認
  - Ollamaが起動しているか確認（`ollama serve`）
  - モデルがインストールされているか確認（`ollama list`）

---

## トラブルシューティング

### 問題1: 翻訳が失敗する

#### 症状
- ショートカットキーを押しても何も起こらない
- エラーメッセージが表示される

#### 解決方法

1. **Ollamaが起動しているか確認**

   ターミナルで以下を実行：
   ```bash
   ollama serve
   ```

2. **モデルがインストールされているか確認**

   ターミナルで以下を実行：
   ```bash
   ollama list
   ```

   使用するモデル（例: `qwen2.5:3b`）がリストに表示されることを確認。
   表示されない場合：
   ```bash
   ollama pull qwen2.5:3b
   ```

3. **Ollama接続をテスト**

   - Honnyaku設定画面を開く
   - 「接続をテスト」ボタンをクリック
   - 接続状態を確認

4. **ログを確認**

   開発モードで起動してエラーログを確認：
   ```bash
   cd /Applications/Honnyaku.app/Contents/Resources
   ./honnyaku
   ```

### 問題2: ショートカットキーが効かない

#### 症状
- ショートカットキーを押しても翻訳が開始されない

#### 解決方法

1. **アクセシビリティ権限を確認**

   - システム環境設定 → プライバシーとセキュリティ → アクセシビリティ
   - Honnyakuにチェックが入っているか確認
   - チェックが入っていない場合、チェックを入れる

2. **Honnyakuを再起動**

   - Honnyakuを完全に終了（`Cmd+Q`）
   - 再度起動

3. **ショートカット競合を確認**

   - システム環境設定 → キーボード → ショートカット
   - 同じショートカットキーが他のアプリで使用されていないか確認
   - 競合がある場合、Honnyakuの設定画面で別のショートカットに変更

4. **ショートカット登録を確認**

   Honnyakuメインウィンドウで、ショートカットが登録済みであることを確認：
   - 「ショートカット: Cmd+J (登録済み)」と表示されているか確認
   - 登録されていない場合、Honnyakuを再起動

### 問題3: アプリが起動しない

#### 症状
- Honnyaku.appをダブルクリックしても起動しない
- 「開発元を確認できないため開けません」エラー

#### 解決方法

1. **macOSバージョンを確認**

   - macOS 12.0 (Monterey) 以上が必要
   - システム環境設定 → 一般 → 情報 → macOSバージョンを確認

2. **セキュリティ設定を確認**

   - システム環境設定 → プライバシーとセキュリティ
   - 「このまま開く」ボタンをクリック
   - または、アプリを右クリック → 「開く」を選択

3. **権限をリセット**

   ターミナルで以下を実行：
   ```bash
   xattr -cr /Applications/Honnyaku.app
   ```

4. **ログを確認**

   - コンソール.appを開く
   - 「honnyaku」で検索
   - エラーログを確認

### 問題4: 翻訳速度が遅い

#### 症状
- 翻訳に10秒以上かかる
- タイムアウトエラーが発生する

#### 解決方法

1. **より小さいモデルを使用**

   ```bash
   # 高速モデルをインストール
   ollama pull qwen2.5:0.5b  # または qwen2.5:1.5b

   # Honnyaku設定画面でモデルを変更
   # モデル名: qwen2.5:0.5b
   ```

2. **OllamaのGPU設定を確認**

   macOS版Ollamaは自動的にMetal（GPU）を使用します。
   GPUが正しく認識されているか確認：
   ```bash
   ollama run qwen2.5:3b "Hello"
   ```

   出力に`Metal GPU`と表示されることを確認。

3. **メモリを確保**

   - 他のアプリケーションを終了
   - ブラウザのタブを閉じる
   - 不要なバックグラウンドプロセスを終了

4. **プリロード機能を有効化**

   Honnyakuは起動時にモデルをプリロードして初回翻訳を高速化します。
   この機能は自動的に有効化されています。

### 問題5: 翻訳結果が不正確

#### 症状
- 翻訳品質が低い
- 意味が通らない翻訳

#### 解決方法

1. **より大きいモデルを使用**

   ```bash
   # 高品質モデルをインストール
   ollama pull qwen2.5:7b

   # Honnyaku設定画面でモデルを変更
   # モデル名: qwen2.5:7b
   ```

2. **日本語特化モデルを使用**

   日本語翻訳には、ABEJA-Qwen2.5-7b-Japaneseモデルがより高品質です。
   インストール方法は[README.md](../README.md#21-日本語特化モデルabeja-qwen25-7b-japaneseのインストール)を参照。

3. **テキストを分割**

   長いテキストは短く分割して翻訳すると品質が向上する場合があります。

---

## FAQ

### Q1: Honnyakuは無料ですか？

**A**: はい、Honnyakuは完全無料のオープンソースソフトウェアです（MITライセンス）。

### Q2: インターネット接続は必要ですか？

**A**: Ollamaセットアップ後は、完全にオフラインで動作します。翻訳データが外部サーバーに送信されることはありません。

### Q3: どの言語ペアがサポートされていますか？

**A**: 現在、日本語 ↔ 英語のみサポートしています。将来的に韓国語対応を予定しています。

### Q4: WindowsやLinuxで使用できますか？

**A**: 現在はmacOSのみサポートしています。将来的にクロスプラットフォーム対応を検討中です。

### Q5: 翻訳データは保存されますか？

**A**: いいえ、Honnyakuは翻訳履歴を保存しません。すべての翻訳はローカルで処理され、完了後は破棄されます。

### Q6: Ollamaモデルはどこに保存されますか？

**A**: Ollamaモデルは`~/.ollama/models`に保存されます。ディスク容量を確保したい場合、不要なモデルを削除できます：
```bash
ollama rm <model-name>
```

### Q7: 複数のOllamaモデルを切り替えられますか？

**A**: はい、設定画面で使用するモデルを変更できます。事前に`ollama pull <model-name>`でモデルをインストールしておく必要があります。

### Q8: カスタムプロンプトを設定できますか？

**A**: 現在のバージョンではサポートされていません。将来のバージョンで実装予定です。

### Q9: 翻訳履歴を保存できますか？

**A**: 現在のバージョンではサポートされていません。将来のバージョンで実装予定です。

### Q10: アンインストール方法は？

**A**:
1. 「アプリケーション」フォルダから`Honnyaku.app`をゴミ箱に移動
2. （オプション）設定ファイルを削除:
   ```bash
   rm -rf ~/Library/Application\ Support/com.honnyaku.app
   ```
3. （オプション）Ollamaをアンインストール:
   ```bash
   brew uninstall ollama
   rm -rf ~/.ollama
   ```

---

## サポート

さらにサポートが必要な場合：

- **GitHub Issues**: [バグ報告](https://github.com/sk8metalme/honnyaku/issues)
- **GitHub Discussions**: [質問・提案](https://github.com/sk8metalme/honnyaku/discussions)
- **ドキュメント**: [README.md](../README.md)、[CONTRIBUTING.md](../CONTRIBUTING.md)

---

Honnyakuをお使いいただきありがとうございます！
