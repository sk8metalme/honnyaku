---
name: /michi:pr-resolve
description: PRレビューコメントへの対応を支援する
---

# PRコメント対応

このコマンドは、プルリクエストのレビューコメントへの対応を支援し、すべてのコメントが適切に解決されているか確認します。

## サブエージェント呼び出し

**重要**: このコマンドは `pr-resolver` サブエージェントを使用します。

pr-resolver サブエージェントを使用して、PRレビューコメントへの対応を確認してください。

## 確認項目

### 1. コメントの収集
- GitHub PR APIを使用してコメント取得
- レビュー承認/変更要求の確認
- 未解決コメントのリスト化
- 返信済みコメントの確認

### 2. 対応状況の確認
- コード変更による対応
- コメントでの返信による対応
- 「Resolve conversation」の実行状況
- 対応漏れの検出

### 3. 対応完了の検証
- すべてのコメントへの対応完了
- レビュアーからの再承認の確認
- マージ可能状態の確認

## 使用方法

### 基本的な使い方

```bash
# 現在のブランチのPRコメントを確認
/michi:pr-resolve

# 特定のPR番号を指定
/michi:pr-resolve 123
```

### GitHub CLI連携

コマンド内部で以下のGitHub CLIコマンドを使用します：

```bash
# PRコメント一覧取得
gh pr view <PR番号> --json comments,reviews

# PRステータス確認
gh pr status

# PRコメント表示
gh pr view <PR番号>
```

## 対応フロー

### ステップ1: コメント収集
```markdown
## 未解決コメント一覧
1. [ファイル名:行数] レビュアー: コメント内容
2. [ファイル名:行数] レビュアー: コメント内容
```

### ステップ2: 対応計画
```markdown
## 対応計画
- [ ] コメント1: コード修正（認証ロジックの改善）
- [ ] コメント2: 返信のみ（設計意図の説明）
- [ ] コメント3: コード修正（テストケース追加）
```

### ステップ3: 対応実施
- コード修正が必要な箇所を特定
- 修正内容を提案
- コミットメッセージの推奨

### ステップ4: 対応完了確認
```markdown
## 対応完了レポート
✓ すべてのコメントに対応済み
✓ レビュアーから再承認を獲得
✓ マージ可能状態
```

## 出力

PRコメント対応結果は以下の形式で出力されます：

1. **サマリー**: 総コメント数、未解決数、対応完了数
2. **未解決コメント詳細**: 各コメントの内容と推奨対応
3. **対応済みコメント**: すでに解決済みのコメント
4. **次のアクション**: マージ前に必要な作業

## Phase A統合

このコマンドはPhase A（PR前自動テスト）またはレビュー対応時に実行することを推奨します。

## GitHub CLI必須

このコマンドは `gh` コマンド（GitHub CLI）が必要です。
未インストールの場合は以下でインストールしてください：

```bash
# macOS
brew install gh

# 認証
gh auth login
```

## 環境変数

GitHubトークンが必要な場合は、以下の環境変数を設定してください：

```bash
export GITHUB_TOKEN="your_token_here"
```

## 使用例

### PRレビュー対応の完全フロー

```bash
# 1. PRコメントを確認
/michi:pr-resolve

# 2. コメントに基づいてコード修正
# （Claude Codeが修正を提案）

# 3. 変更をコミット
git add .
git commit -m "fix: レビューコメントに対応"

# 4. PRを更新
git push

# 5. 再度確認
/michi:pr-resolve

# 6. すべて解決済みならマージ
gh pr merge
```

## 言語設定

出力言語は .kiro/project.json の設定に従います。
